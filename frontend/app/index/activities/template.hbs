<div
  class="btn-toolbar btn-toolbar--right form-group w-full grid place-items-end mt-2"
>
  <button
    type="button"
    class="btn btn-success"
    title="Generate timesheet for all the activities listed above"
    {{on "click" this.generateReportsCheck}}
    data-test-activity-generate-timesheet
  >
    Generate timesheet
  </button>
</div>

<div class="activities flex flex-row-reverse py-2">
  <div
    class="activities-edit peer max-lg:flex-grow lg:[:not(:empty)]:basis-1/3"
  >{{outlet}}</div>
  <div class="activities-list flex-grow max-lg:peer-[:not(:empty)]:hidden">
    {{#if this.activities}}
      <table class="table table--striped table--activities w-full">
        <tbody class="stripes">
          {{#each this.sortedActivities as |activity|}}
            {{!template-lint-disable no-invalid-interactive}}
            <tr
              title={{unless activity.transferred "Click to edit"}}
              data-test-activity-row
              data-test-activity-row-id={{activity.id}}
              class="{{if
                  activity.transferred
                  'transferred'
                  'cursor-pointer text-black'
                }}
                {{if activity.active 'primary'}}
                {{if (eq activity.id this.editId) 'selected'}}"
              {{on "click" (fn this.editActivity activity)}}
            >
              <td class="py-1 px-2">
                {{moment-format activity.from "HH:mm"}}
                -
                {{#unless activity.active}}
                  {{moment-format activity.to "HH:mm"}}
                {{/unless}}
              </td>
              <td
                class="py-1 px-2"
                title="{{activity.task.project.customer.name}} > {{activity.task.project.name}} > {{activity.task.name}}"
              >
                {{#if activity.task}}
                  <div>
                    {{activity.task.project.customer.name}}
                    <strong>&gt;</strong>
                    {{activity.task.project.name}}
                    <strong>&gt;</strong>
                    {{activity.task.name}}
                  </div>
                {{else}}
                  <strong>Unknown task</strong>
                {{/if}}
              </td>
              <td class="py-1 px-2" title={{activity.comment}}>
                <div class="comment-field">{{activity.comment}}</div>
                {{#if activity.task.project.customerVisible}}
                  <CustomerVisibleIcon class="activity-customer-visible-icon" />
                {{/if}}
              </td>
              <td class="py-1 px-2">
                <div><SyCheckmark
                    @checked={{activity.review}}
                    @highlight={{true}}
                  />
                  Needs review</div>
                <div><SyCheckmark
                    @checked={{activity.notBillable}}
                    @highlight={{true}}
                  />
                  Not billable</div>
              </td>
              <td class="py-1 px-2">
                {{#if activity.active}}
                  <DurationSince @from={{activity.from}} />
                {{else}}
                  {{format-duration activity.duration}}
                {{/if}}
              </td>
              <td class="py-1 px-4 flex justify-end h-full">
                {{#if activity.active}}
                  <button
                    type="button"
                    data-test-stop-activity
                    class="btn btn-danger"
                    {{on "click" (fn this.stopActivity activity)}}
                  >
                    <FaIcon @icon="stop" @prefix="fas" />
                  </button>
                {{else}}
                  <button
                    type="button"
                    data-test-start-activity
                    class="btn btn-success"
                    {{on "click" (fn this.startActivity activity)}}
                  >
                    <FaIcon @icon="play" @prefix="fas" />
                  </button>
                {{/if}}
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{else}}
      <div class="text-center"><em>No activities yet</em></div>
    {{/if}}
  </div>
</div>

<SyModal @visible={{this.showOverlappingWarning}} as |modal|>
  <modal.header>
    Activities overlap
  </modal.header>
  <modal.body>
    Overlapping activities will not be taken into account for the timesheet.
  </modal.body>
  <modal.footer data-test-overlapping-warning>
    <button
      class="btn btn-primary"
      type="button"
      {{on
        "click"
        (if
          this.showUnknownWarning
          (fn (mut this.showOverlappingWarning) false)
          this.generateReports
        )
      }}
    >That's fine</button>
    <button
      class="btn btn-default"
      type="button"
      {{on
        "click"
        (queue
          (fn (mut this.showOverlappingWarning) false)
          (fn (mut this.showUnknownWarning) false)
        )
      }}
    >Cancel</button>
  </modal.footer>
</SyModal>

<SyModal @visible={{this.showUnknownWarning}} as |modal|>
  <modal.header>
    Activities contain unknown tasks
  </modal.header>
  <modal.body>
    Unknown tasks will not be taken into account for the timesheet.
  </modal.body>
  <modal.footer data-test-unknown-warning>
    <button
      class="btn btn-primary"
      type="button"
      {{on
        "click"
        (if
          this.showOverlappingWarning
          (fn (mut this.showUnknownWarning) false)
          this.generateReports
        )
      }}
    >That's fine</button>
    <button
      class="btn btn-default"
      type="button"
      {{on
        "click"
        (queue
          (fn (mut this.showUnknownWarning) false)
          (fn (mut this.showOverlappingWarning) false)
        )
      }}
    >Cancel</button>
  </modal.footer>
</SyModal>